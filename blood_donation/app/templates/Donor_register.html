<!DOCTYPE html>
<html>
<head>
  <title>Register</title>
  <style>
    /* Global styles */
body {
  font-family: sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f2f2f2;
}

h1, h2, h3 {
  font-weight: normal;
}

/* Header styles */
header {
  background-color: #fff;
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

nav {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
}

nav a {
  text-decoration: none;
  color: #333;
  padding: 10px 15px;
  border-right: 1px solid #ccc;
}

nav a:last-child {
  border-right: none;
}

/* Main content styles */
main {
  padding: 20px;
}
.invalid-email {
  border: 1px solid red;
}


#register {
  background-color: #fff;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  padding: 20px;
}

.container {
  max-width: 600px;
  margin: 0 auto;
}

/* Form styles */
form {
  display: flex;
  flex-direction: column;
}

.row {
  margin-bottom: 15px;
  display: flex;
  flex-wrap: wrap;
}

.col-md-6 {
  width: 50%;
  padding: 0 5px;
}

label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}

input,
select,
textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 3px;
  font-size: 16px;
}

textarea {
  height: 100px;
}

select {
  appearance: none;
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4IiBoZWlnaHQ9IjQiIHZpZXdCb3g9IjAgMCA4IDQiPgogIDxwYXRoIGQ9Im0yIDAgcTAyIDIgMiAyIDItMi0yLTItMi0yIDAgMiIgZmlsbD0iI2ZmZiIgZmlsbC1ydWxlPSJldmVub2RlIi8+CiAgPHBhdGggZD0ibTAzLjUyNSAxLjUxNWwtMiAtMi0xLjUxNSAxLjUxNSAxLjQxNSAtMS40MTVMMiA0bDIgLTIuNTg1em4tMyAtMyIvPjwvc3ZnPg==");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 15px;
}

input[type="submit"] {
  background-color: #3b5998;
  color: #fff;
  border: none;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 5px;
}

/* Footer styles */
footer {
  background-color: #f2f2f2;
  padding: 20px;
  text-align: center;
}

footer p {
  color: #ccc;
  font-size: 14px;
}

  </style>
  <script>
    const form = document.getElementById('register');

    form.addEventListener('submit', (event) => {
      event.preventDefault(); // Prevent default form submission

      const formData = new FormData(form);

      // Extract data from the form
      const username = formData.get('first_name') + ' ' + formData.get('last_name');
      const password = formData.get('password');
      const confirmPassword = formData.get('confirm_password');
      const email = formData.get('email');
      const name = username; // Assuming name is same as username for now
      const mobile = formData.get('phone');
      const bloodType = formData.get('blood_type');
      const dob = formData.get('date_of_birth');
      const gender = formData.get('gender');
      const weight = parseFloat(formData.get('weight'));
      const address = formData.get('address');

      // Basic client-side validation
      if (!username || !password || !confirmPassword || !email || !bloodType || !dob || !gender || !weight || !address) {
        alert('Please fill in all required fields.');
        return;
      }

      // Check password confirmation
      if (password !== confirmPassword) {
        alert('Passwords do not match.');
        return;
      }

      // Prepare GraphQL mutation query
      const query = `
        mutation createDonor($username: String!, $password: String!, $email: String!, $name: String!, $mobile: String!, $bloodType: String!, $dob: String!, $gender: String!, $weight: Float!, $address: String!) {
          createDonor(username: $username, password: $password, confirmPassword: $confirmPassword, email: $email, name: $name, mobile: $mobile, bloodType: $bloodType, dob: $dob, gender: $gender, weight: $weight, address: $address) {
            id
            username
            email
          }
        }
      `;
      const emailInput = document.getElementById('email');

emailInput.addEventListener('input', (event) => {
  const emailValue = event.target.value;

  // Basic validation using regular expression
  const isValidEmail = /^\S+@\S+\.\S+$/.test(emailValue);

  // Highlight invalid email with CSS class
  if (!isValidEmail) {
    emailInput.classList.add('invalid-email');
  } else {
    emailInput.classList.remove('invalid-email');
  }
});
emailError.textContent = '';
  emailInput.classList.remove('invalid-email');

  if (!isValidEmail) {
    // Build a more specific error message
    let errorMessage = 'Invalid email format.';
    if (!emailValue) {
      errorMessage = 'Email is required.';
    } else if (!emailValue.includes('@')) {
      errorMessage = 'Missing "@" symbol.';
    } else if (!emailValue.split('@')[1].includes('.')) {
      errorMessage = 'Missing domain name.';
    }

    // Display error message and add styling
    emailError.textContent = errorMessage;
    emailInput.classList.add('invalid-email');
  }
});


      // Create GraphQL variables with form data
      const variables = {
        username,
        password,
        confirmPassword,
        email,
        name,
        mobile,
        bloodType,
        dob,
        gender,
        weight,
        address,
      };

      // Send GraphQL request using your preferred fetch library
      fetch('/graphql/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ query, variables }),
      })
      .then(response => response.json())
      .then(data => {
        if (data.errors) {
          // Handle GraphQL errors
          const errorMessages = data.errors.map(error => error.message).join('\n');
          alert('Registration failed: ' + errorMessages);
        } else {
          // Registration successful
          alert('Registration successful! Welcome ' + data.data.createDonor.username);
          // Redirect to appropriate page or handle success here
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again later.');
      });
    });
  </script>
</head>
<body>
  <header>
    <h1>Blood Donation Camps</h1>
    <nav>
      <a href="home.html">Home</a>
      <a href="login.html">Login</a>
    </nav>
  </header>
  <main>
      <div class="container">
        <h2>Register to Donate Blood</h2>
        <form id="register" method="post">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-6">
                    <label for="first_name">First Name</label>
                    <input type="text" name="first_name" id="first_name" required>
                </div>
                <div class="col-md-6">
                    <label for="last_name">Last Name</label>
                    <input type="text" name="last_name" id="last_name" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="email">Email Address</label>
                    <input type="email" name="email" id="email" required pattern="^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$">
                    <span id="email-error" class="error-message"></span>
                </div>
                <div class="col-md-6">
                    <label for="phone">Phone Number</label>
                    <input type="tel" name="phone" id="phone" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="password">Password</label>
                    <input type="password" name="password" id="password" required>
                </div>
                <div class="col-md-6">
                    <label for="confirm_password">Confirm Password</label>
                    <input type="password" name="confirm_password" id="confirm_password" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="blood_type">Blood Type</label>
                    <select name="blood_type" id="blood_type" required>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="date_of_birth">Date of Birth</label>
                    <input type="date" name="date_of_birth" id="date_of_birth" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="gender">Gender</label>
                    <select name="gender" id="gender" required>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="weight">Weight (kg)</label>
                    <input type="number" name="weight" id="weight" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <label for="address">Address</label>
                    <textarea name="address" id="address" required></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <input type="submit" value="Register">
                </div>
            </div>
        </form>
      </div>
    </section>
  </main>
  <footer>
    <p>Copyright 2023 Blood Donation Camps</p>
  </footer>
</body>
</html>
